@using X.PagedList
@using X.PagedList.Mvc.Core
@model X.PagedList.IPagedList<ItAssetsFront.Models.EmployeeModels.GetAllEmployee>
@{
    ViewData["Title"] = "Employees";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet" />

<style>
    .table-row-hover:hover {
        background: #f8f9fc !important;
        transition: 0.2s ease-in-out;
    }

    .pagination .page-link:hover {
        background: linear-gradient(135deg, #4e73df, #1cc88a);
        color: #fff !important;
    }

    .pagination .active .page-link {
        background: linear-gradient(135deg, #1cc88a, #4e73df);
        color: #fff !important;
        border: none;
    }
</style>

<section class="pb-3 pb-md-4 pb-xl-5 bg-light">
    <div class="container">
        <div class="row gy-3 gy-md-4">
            <div class="col-12 col-lg-12 col-xl-12">
                <div class="card widget-card shadow-lg border-0 rounded-3 overflow-hidden">

                    <!-- Gradient Header -->
                    <div class="card-header text-white d-flex justify-content-between align-items-center py-3 px-4 shadow-sm"
                         style="background: linear-gradient(135deg, #4e73df, #1cc88a);">
                        <h5 class="mb-0 fw-bold">
                            <i class="bx bx-user-circle me-2 fs-4"></i> Employees
                        </h5>
                        <a asp-action="Create" class="btn btn-light btn-sm fw-semibold shadow-sm rounded-pill">
                            <i class="bx bx-plus-circle text-success me-1"></i> Add Employee
                        </a>
                    </div>

                    <div class="card-body p-4">

                        <!-- Search Bar -->
                        <div class="input-group mb-4 shadow-sm">
                            <span class="input-group-text bg-white border-end-0">
                                <i class="bx bx-search-alt-2"></i>
                            </span>
                            <input type="text" class="form-control border-start-0"
                                   id="employeeSearchInput"
                                   placeholder="Search employees..." onkeyup="filterEmployees()" />
                        </div>

                        <!-- Table -->
                        <div class="table-responsive">
                            <table class="table table-hover align-middle shadow-sm rounded" id="employeesTable">
                                <thead class="table-primary text-dark">
                                    <tr>
                                        <th style="width: 50px;">#</th>
                                        <th>Name</th>
                                        <th>Position</th>
                                        <th>Email</th>
                                        <th class="text-center" style="width: 160px;">Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @if (Model != null && Model.Any())
                                    {
                                        int index = (Model.PageNumber - 1) * Model.PageSize + 1;
                                        foreach (var emp in Model)
                                        {
                                            <tr class="table-row-hover">
                                                <td class="fw-bold text-secondary">@index</td>
                                                <td class="employee-data">
                                                    <span class="badge px-3 py-2 rounded-pill shadow-sm text-white fw-semibold"
                                                          style="background: linear-gradient(135deg, #6a11cb, #2575fc);">
                                                        <i class="bx bx-user me-1"></i> @emp.name
                                                    </span>
                                                </td>
                                                <td class="employee-data">@emp.position</td>
                                                <td class="employee-data">@emp.email</td>
                                                <td class="text-center">
                                                    <a asp-action="Edit" asp-route-id="@emp.id"
                                                       class="btn btn-sm btn-outline-warning rounded-pill shadow-sm me-2"
                                                       title="Edit">
                                                        <i class='bx bx-edit-alt'></i>
                                                    </a>
                                                    <button class="btn btn-sm btn-outline-danger rounded-pill shadow-sm"
                                                            data-bs-toggle="modal"
                                                            data-bs-target="#deleteConfirmModal"
                                                            data-employee-id="@emp.id" title="Delete">
                                                        <i class='bx bx-trash-alt'></i>
                                                    </button>
                                                </td>
                                            </tr>
                                            index++;
                                        }
                                    }
                                    else
                                    {
                                        <tr>
                                            <td colspan="5" class="text-center text-muted py-4">
                                                <i class="bx bx-info-circle me-1"></i> No employees found.
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>

                        <!-- Pagination -->
                        <div class="d-flex justify-content-center mt-4">
                            @Html.PagedListPager(
                                     Model,
                                     page => Url.Action("Index", new { page }),
                                     new PagedListRenderOptions
                            {
                                LiElementClasses = new[] { "page-item" },
                                PageClasses = new[] { "page-link rounded-pill shadow-sm border-0" },
                                UlElementClasses = new[] { "pagination pagination-sm" },
                                DisplayLinkToFirstPage = PagedListDisplayMode.Always,
                                DisplayLinkToLastPage = PagedListDisplayMode.Always,
                                DisplayLinkToPreviousPage = PagedListDisplayMode.Always,
                                DisplayLinkToNextPage = PagedListDisplayMode.Always
                            }
                                     )
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Delete Modal -->
<div class="modal fade" id="deleteConfirmModal" tabindex="-1"
     aria-labelledby="deleteConfirmLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0 shadow-lg rounded-3">
            <form id="deleteForm" method="post">
                <div class="modal-header text-white"
                     style="background: linear-gradient(135deg, #e74a3b, #c0392b);">
                    <h5 class="modal-title" id="deleteConfirmLabel">
                        <i class="bx bx-error-circle me-2 fs-5"></i> Confirm Deletion
                    </h5>
                    <button type="button" class="btn-close btn-close-white"
                            data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body text-center">
                    <p class="mb-0 text-muted">Are you sure you want to delete this employee?</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-light rounded-pill shadow-sm" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-danger rounded-pill shadow-sm">Yes, Delete</button>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        function filterEmployees() {
            const input = document.getElementById("employeeSearchInput");
            const filter = input.value.toLowerCase();
            const rows = document.querySelectorAll("#employeesTable tbody tr");

            rows.forEach(row => {
                const cells = row.querySelectorAll(".employee-data");
                const text = Array.from(cells).map(cell => cell.innerText.toLowerCase()).join(" ");
                row.style.display = text.includes(filter) ? "" : "none";
            });
        }

        const deleteConfirmModal = document.getElementById('deleteConfirmModal');
        deleteConfirmModal.addEventListener('show.bs.modal', function (event) {
            const button = event.relatedTarget;
            const empId = button.getAttribute('data-employee-id');
            const form = deleteConfirmModal.querySelector('#deleteForm');
            form.action = `/Employee/Delete/${empId}`;
        });
    </script>
}
